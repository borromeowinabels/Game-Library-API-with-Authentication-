/*global $:true */
$(function () {
  "use strict";

  var timeout;

  var elt = $("#uploadModal");
  $('.open-modal').on('click', function () {
    elt.modal('show');
  });

  $('body').on('dragenter', function () {
    if (!elt.is(':visible')) {
      elt.modal('show');
    }
  }).on('dragover', function () {
    timeout = clearTimeout(timeout);
  }).on('dragleave', function (evt) {
    if ($(evt.target).hasClass('modal-backdrop') || !$(evt.target).parents(elt).length) {
      timeout = timeout || setTimeout(elt.modal.bind(elt, 'hide'), 200);
    }
  });

  $('#uploadModal .modal-body').dropzone({
    url: '/upload',
    clickable: '.modal-footer .more',
    previewTemplate: '<p class="dz-file"><span class="label label-important pull-left">Error</span><span class="label label-success pull-left">Success</span>&nbsp;<span class="name pull-left" data-dz-name></span> <span class="pull-right text-error" data-dz-errormessage></span><span class="size pull-right" data-dz-size></span><span data-dz-uploadprogress></p>'
  });
});
